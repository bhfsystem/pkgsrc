#!/usr/bin/env bash

function id_install {
  local nm_os
  case "$(uname -s)" in
    Darwin)
      nm_os="$(uname -s)_$(uname -r | cut -d. -f1)"
      ;;
    Linux)
      nm_os="$(uname -s)_$(uname -r | cut -d- -f1 | cut -d. -f1-3)"
      ;;
    *)
      nm_os="$(uname -s)"
      ;;
  esac

  echo "$nm_os/$PKG_HOME" | tr / _
}

function profile {
  local shome="$(cd -P -- "$(dirname -- "$BASH_SOURCE")/.." && pwd -P)"

  if [[ -z "${PKG_HOME:-}" ]]; then
    PATH="$shome/sbin:$shome/bin:$shome/exec:$PATH"
    return 0
  else
    PATH="$shome/sbin:$shome/bin:$PKG_HOME/install/sbin:$PKG_HOME/install/bin:$PKG_HOME/install/gnu/bin:$shome/exec:$PATH"
  fi

  export PACKAGES="$PKG_HOME/packages/$(id_install)"
  export WRKOBJDIR="$PKG_HOME/tmp/pkgsrc"
  export DISTDIR="$PKG_HOME/distfiles"

  export PKG_OPT="env MAKEFLAGS= MFLAGS= PACKAGES=$PACKAGES WRKOBJDIR=$WRKOBJDIR DISTDIR=$DISTDIR PKG_RCD_SCRIPTS=no SKIP_LICENSE_CHECK=yes"
  export BMAKE="$PKG_OPT $PKG_HOME/bin/bmake"
  export PKGADD="$PKG_OPT PKG_PATH=$PACKAGES/All $PKG_HOME/sbin/pkg_add"

  export SH="$(which bash)"
}

profile
